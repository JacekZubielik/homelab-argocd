---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

helmCharts:
  - name: metallb
    repo: https://metallb.github.io/metallb
    version: 0.13.12
    releaseName: metallb
    namespace: metallb-system    # kubeseal expects kube-system namespace, otherwise you'd have to use --controller-namespace in every command
    includeCRDs: true
    valuesFile: values.yaml  # overrides name to sealed-secrets-controller as kubeseal expects this, otherwise you'd have to specify --controller-name in every command

commonLabels:
  app.kubernetes.io/name: metallb
  app: metallb






# apiVersion: kustomize.config.k8s.io/v1beta1
# kind: Kustomization
# namespace: metallb-system

# resources:
# - github.com/metallb/metallb/config/native?ref=v0.13.12
# #- https://raw.githubusercontent.com/metallb/metallb/v0.13.12/config/manifests/metallb-native.yaml
# - ipaddresspool.yaml
# #- configmap.yaml

# commonLabels:
#   app.kubernetes.io/name: metallb
#   app: metallb


# patches:
#   - target:
#       version: v1
#       group: apps
#       kind: DaemonSet
#       namespace: metallb-system
#       name: speaker
#     patch: |-
#       - op: add
#         path: /spec/template/spec/tolerations/-
#         value: {"effect":"NoSchedule","key":"example.com/some-taint","operator":"Exists"}

# patches:
#   - |-
#       apiVersion: apps/v1
#       kind: Deployment
#       metadata:
#         name: controller
#         namespace: metallb-system
#       spec:
#         template:
#           spec:
#             securityContext:
#               $patch: replace
#               runAsNonRoot: true

# patches:
#   - target:
#       kind: Deployment
#       name: controller
#       namespace: metallb-system
#     patch: |-
#       - op: remove
#         path: /spec/template/spec/securityContext/runAsUser
