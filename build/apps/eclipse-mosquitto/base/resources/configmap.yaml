apiVersion: v1
kind: ConfigMap
metadata:
  name: eclipse-mosquitto-config
  namespace: iot
  # annotations:
    #argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    # argocd.argoproj.io/sync-wave: "4"
  labels:
    app.kubernetes.io/name: eclipse-mosquitto
data:
  mosquitto.conf: |
    allow_anonymous false
#    password_file /mosquitto/config/passwd
    persistence true
    persistence_location /mosquitto/data/
    persistence_file mosquitto.db
    protocol mqtt
    listener 1883
    listener 8883
    log_dest file /mosquitto/log/mosquitto.log
    log_dest stdout
    pid_file /mosquitto/mosquitto.pid
    cafile /mosquitto/config/certs/ca.crt
    certfile /mosquitto/config/certs/server.crt
    keyfile /mosquitto/config/certs/server.key
    require_certificate true
    socket_domain ipv4